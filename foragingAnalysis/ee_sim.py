import numpy as np
import pandas as pd
from pathos.multiprocessing import ProcessingPool as Pool
from pathos.multiprocessing import cpu_count

# Switch probabilities
explore_exploit_switch_probs_zeros = np.array([ 0.15082523,  0.11273811,  0.1182511 ,  0.13540426,  0.09219961, 0.08865131,  0.08399131,  0.08090388,  0.07546962,  0.07349407, 0.07055033,  0.06820531,  0.06511635,  0.06320729,  0.06096301, 0.05900733,  0.05687092,  0.05546949,  0.05371715,  0.05281954, 0.05122264,  0.05023315,  0.04868665,  0.04761524,  0.04640221, 0.04547419,  0.04446721,  0.04385496,  0.04275818,  0.04181299, 0.04107839,  0.04040258,  0.03924025,  0.03842631,  0.03773228, 0.03766557,  0.0367962 ,  0.03632237,  0.03541491,  0.03520086, 0.03449706,  0.03399678,  0.0336486 ,  0.03283903,  0.03225199, 0.03214159,  0.03137979,  0.03147636,  0.03091341,  0.03056752, 0.02939078,  0.02906439,  0.02895459,  0.0288171 ,  0.02793981, 0.02784593,  0.02708985,  0.02730049,  0.0264803 ,  0.02654992, 0.02642038,  0.02587568,  0.02598764,  0.02539181,  0.0247169 , 0.02489977,  0.02494587,  0.02454303,  0.024053  ,  0.0239091 , 0.02375833,  0.02371993,  0.02266508,  0.02292811,  0.02241962, 0.02257423,  0.02185273,  0.02253684,  0.0213925 ,  0.02140912, 0.02142243,  0.02083685,  0.02061161,  0.02079234,  0.02019856, 0.02045606,  0.02035303,  0.0203054 ,  0.02045256,  0.0200706 , 0.01989954,  0.01959135,  0.01959332,  0.01943378,  0.01938998, 0.0187955 ,  0.01914204,  0.01868668,  0.01849951,  0.01827237, 0.01873874,  0.01822657,  0.01801088,  0.01840091,  0.01757872, 0.0178311 ,  0.01797747,  0.01757549,  0.01734441,  0.01736792, 0.01743087,  0.01748678,  0.01687187,  0.0169527 ,  0.01703159, 0.01683693,  0.01658787,  0.01647199,  0.01629906,  0.01622578, 0.01653264,  0.01617622,  0.01596043,  0.01595708,  0.0160788 , 0.01610076,  0.01597434,  0.01524666,  0.01566266,  0.01501916, 0.01532658,  0.01543254,  0.01501975,  0.01510705,  0.01459011, 0.01448415,  0.01437414,  0.01515215,  0.0148776 ,  0.01484041, 0.01460319,  0.01436997,  0.01492267,  0.01461439,  0.01436741, 0.01391446,  0.01380126,  0.01434766,  0.01389504,  0.01365624, 0.01387622,  0.01356491,  0.01367257,  0.01347408,  0.01368378, 0.01343067,  0.01363242,  0.01325324,  0.01293866,  0.01304032, 0.01323774,  0.01267349,  0.01301026,  0.01311134,  0.01292387, 0.01256693,  0.01288845,  0.0131974 ,  0.01259072,  0.0124735 , 0.01200449,  0.01228363,  0.01247809,  0.01218414,  0.01183664, 0.01220091,  0.01216182,  0.01205142,  0.01193972,  0.01209042, 0.01185785,  0.01178211,  0.01153891,  0.01121427,  0.01119203, 0.01163621,  0.01217485,  0.0116493 ,  0.01158046,  0.01160336, 0.01171814,  0.0114365 ,  0.01159208,  0.01132243,  0.0110131 , 0.0116961 ,  0.01124281,  0.01126483,  0.01094137,  0.01105146, 0.01163768,  0.0111427 ,  0.01093794,  0.01080416,  0.0110603 , 0.01067321,  0.00999203,  0.0105427 ,  0.01068831,  0.01064702, 0.01072502,  0.01001034,  0.0101669 ,  0.01024446,  0.01053271, 0.01022241,  0.0099404 ,  0.00979744,  0.00982872,  0.00979671, 0.01020834,  0.0104463 ,  0.01015401,  0.00992577,  0.01030787, 0.00984849,  0.0099379 ,  0.01005976,  0.00974956,  0.00988017, 0.01008615,  0.00961913,  0.00948125,  0.00923382,  0.01019564, 0.00959696,  0.00922953,  0.00982767,  0.00928573,  0.0093267 , 0.0093774 ,  0.00940265,  0.0086687 ,  0.00870484,  0.00935587, 0.00894068,  0.0091778 ,  0.0092318 ,  0.00874947,  0.00886565, 0.00927965,  0.0093331 ,  0.00936139,  0.0088222 ,  0.00844533, 0.00920676,  0.00891997,  0.00895124,  0.00888664,  0.00915933, 0.00839346,  0.00900389,  0.00906795,  0.00857122,  0.00872279, 0.00879791,  0.00877278,  0.00917888,  0.00833913,  0.0086165 , 0.00856227,  0.00840142,  0.00860613,  0.00877677,  0.00858796, 0.00784086,  0.00804411,  0.00894317,  0.00791996,  0.00876059, 0.00830412,  0.00833304,  0.00858801,  0.00814571,  0.00848121, 0.0080624 ,  0.00834961,  0.00748508,  0.00791363,  0.00767235, 0.00813092,  0.00799131,  0.00782653,  0.00787078,  0.00842006, 0.00782051,  0.00834305,  0.00796847,  0.00834543,  0.00767523, 0.00776314,  0.00794827,  0.00765441,  0.00828907,  0.00782234, 0.0079327 ,  0.00792888,  0.00766263,  0.00838301,  0.00730916, 0.00791317,  0.00790817,  0.00749235,  0.0078275 ,  0.00729679, 0.00782961,  0.00703096,  0.00740486,  0.00741622,  0.00799947, 0.00791887,  0.00740341,  0.00757398,  0.00806627,  0.00788462, 0.00749025,  0.00757606,  0.00716619,  0.0075546 ,  0.00742472, 0.00697408,  0.00774133,  0.00736071,  0.00741866,  0.00786089, 0.0070918 ,  0.00690999,  0.00664735,  0.00711291,  0.00721631, 0.00691165,  0.00717936,  0.007333  ,  0.00715505,  0.00688976, 0.00715908,  0.00670547,  0.00710512,  0.00676393,  0.00712177, 0.00695342,  0.00628089,  0.0070112 ,  0.00716842,  0.00737678, 0.00689367,  0.00687859,  0.0069778 ,  0.00638793,  0.00695084, 0.00682085,  0.00704384,  0.00683654,  0.0064985 ,  0.00654682, 0.0066359 ,  0.00700182,  0.00644974,  0.00664604,  0.0065085 , 0.00624627,  0.00670265,  0.00703407,  0.00676983,  0.00629589, 0.00696482,  0.00708819,  0.00677064,  0.00647596,  0.00685045, 0.00633622,  0.00633724,  0.0061829 ,  0.00570595,  0.006651  , 0.00637641,  0.00650708,  0.00710148,  0.00641973,  0.00647063, 0.00591764,  0.00600233,  0.00565308,  0.00670297,  0.00623422, 0.00602507,  0.00623754,  0.00666988,  0.00617261,  0.00688762, 0.00609259,  0.00609716,  0.0060095 ,  0.00643073,  0.00602305, 0.00643383,  0.00609515,  0.00543237,  0.00558138,  0.00571563, 0.00544095,  0.0055095 ,  0.00586821,  0.00639893,  0.00624002, 0.00660445,  0.00555631,  0.00619042,  0.00604706,  0.00628182, 0.00567493,  0.00630792,  0.00565739,  0.00562239,  0.00554973, 0.0054271 ,  0.00584732,  0.00614931,  0.00573479,  0.00554199, 0.00539997,  0.00590216,  0.0053235 ,  0.00576561,  0.00572943, 0.00590694,  0.00582024,  0.00588953,  0.00567172,  0.00598422, 0.00559163,  0.00530989,  0.00588203,  0.00577182,  0.00582715, 0.00521437,  0.00557994,  0.00563582,  0.00551275,  0.00562393, 0.00552936,  0.00524802,  0.00602788,  0.00525433,  0.00498445, 0.00600125,  0.00541326,  0.00549088,  0.00523024,  0.00521503, 0.00455191,  0.00550447,  0.00545052,  0.00514937,  0.00526993, 0.00566375,  0.00551645,  0.00585961,  0.00548389,  0.00541793, 0.00580176,  0.00569768,  0.00590812,  0.00560972,  0.00518469, 0.00489766,  0.00500221,  0.00538051,  0.00580197,  0.00522291, 0.00544979,  0.00524184,  0.00490393,  0.00442427,  0.00496201, 0.00501278,  0.00490676,  0.00519427,  0.00575748,  0.00503952, 0.00477704,  0.0052986 ,
    0.00561   ,  0.00516929,  0.00447266, 0.00563575,  0.00550217,  0.00543498,  0.00505028,  0.00532446])
exploit_explore_switch_probs_zeros = np.array([ 0.        ,  0.        ,  0.        ,  0.        ,  0.14514628, 0.11770142,  0.09781431,  0.08510546,  0.07603056,  0.08105964, 0.08066237,  0.0775803 ,  0.07123671,  0.0655364 ,  0.062347  , 0.06021436,  0.05839971,  0.05757167,  0.05585907,  0.05601381, 0.0546443 ,  0.05480098,  0.05272161,  0.05242774,  0.05135394, 0.05017737,  0.0492532 ,  0.04841608,  0.0470654 ,  0.04707908, 0.04563128,  0.0454428 ,  0.0450955 ,  0.04430125,  0.04384289, 0.04325801,  0.04237296,  0.0419542 ,  0.04115665,  0.04109105, 0.04013342,  0.03961638,  0.03938268,  0.03873453,  0.03838346, 0.03759206,  0.03715789,  0.03736845,  0.03730805,  0.03686223, 0.03585769,  0.0359521 ,  0.03497629,  0.03479485,  0.03488459, 0.03425945,  0.03380672,  0.03346448,  0.03338244,  0.03323738, 0.03283909,  0.03211063,  0.03199243,  0.03172321,  0.03153404, 0.03103686,  0.0307263 ,  0.03081162,  0.03024015,  0.03014207, 0.02969505,  0.02967355,  0.02951741,  0.02921365,  0.02900091, 0.02812588,  0.02848955,  0.02823623,  0.02787579,  0.02810553, 0.02757868,  0.02724338,  0.02656903,  0.02708673,  0.02715705, 0.02640911,  0.02614095,  0.02622604,  0.02595908,  0.02630639, 0.02546706,  0.02588171,  0.02524873,  0.0248841 ,  0.02517171, 0.02507406,  0.02455298,  0.02447221,  0.02438438,  0.02381714, 0.0233895 ,  0.0243265 ,  0.02346339,  0.02334535,  0.02302458, 0.0231988 ,  0.02256012,  0.02225691,  0.02331792,  0.0231256 , 0.02241543,  0.02285297,  0.02239324,  0.02231144,  0.0220817 , 0.0223425 ,  0.02185198,  0.02154139,  0.02162606,  0.02143268, 0.02096354,  0.02153196,  0.02123524,  0.02137964,  0.02076277, 0.02085591,  0.02012533,  0.02034653,  0.0205916 ,  0.02010831, 0.02003349,  0.02013851,  0.02026204,  0.01972545,  0.01897627, 0.01927927,  0.01946503,  0.01929748,  0.01915785,  0.01885556, 0.01872342,  0.01935016,  0.01915343,  0.01867293,  0.01851559, 0.01847827,  0.01824798,  0.01852837,  0.01823199,  0.01865647, 0.01857912,  0.01805906,  0.01762421,  0.01753435,  0.01837011, 0.01717042,  0.01834501,  0.01754539,  0.01782759,  0.01769774, 0.01731792,  0.01683172,  0.01698686,  0.01746241,  0.01704738, 0.0170752 ,  0.01668114,  0.0165585 ,  0.01700103,  0.01641906, 0.01690504,  0.01630749,  0.01603127,  0.01595763,  0.01649241, 0.01648258,  0.01598176,  0.01596642,  0.01619683,  0.01621909, 0.01645505,  0.01561441,  0.01560669,  0.01545632,  0.01570335, 0.01495281,  0.01537646,  0.01575991,  0.01506091,  0.01533434, 0.01468754,  0.01526918,  0.01527602,  0.01511253,  0.01473004, 0.01468639,  0.01534769,  0.01499337,  0.01460387,  0.01476516, 0.01433553,  0.01443122,  0.01474401,  0.01435979,  0.01343778, 0.01399412,  0.01428975,  0.0146172 ,  0.01434629,  0.01369603, 0.01396447,  0.0132441 ,  0.01382957,  0.01328624,  0.01282656, 0.01361623,  0.01391576,  0.01395548,  0.01330176,  0.01317132, 0.01330401,  0.01316235,  0.01381033,  0.01313358,  0.01276036, 0.01358043,  0.01268376,  0.01330067,  0.01234254,  0.01340145, 0.01314276,  0.01210856,  0.01304703,  0.01285825,  0.01253175, 0.01234235,  0.01223026,  0.01297151,  0.01278189,  0.01309846, 0.01243305,  0.01220589,  0.01230581,  0.01214736,  0.01277587, 0.01235904,  0.01217383,  0.01265461,  0.01290055,  0.01258978, 0.01239773,  0.01168929,  0.01187741,  0.01181818,  0.01256439, 0.01217286,  0.01217495,  0.01144155,  0.0113507 ,  0.01153682, 0.01174939,  0.01120017,  0.01106823,  0.01181876,  0.01113087, 0.01115038,  0.01091795,  0.01199784,  0.01128392,  0.01056259, 0.01196256,  0.01118129,  0.0106126 ,  0.01167853,  0.01120358, 0.01241197,  0.01070373,  0.01158725,  0.01035295,  0.01078008, 0.01085096,  0.01136272,  0.01058387,  0.01105088,  0.01056511, 0.01118251,  0.01030359,  0.01093379,  0.0105192 ,  0.01066759, 0.0105616 ,  0.0104408 ,  0.01064378,  0.0102002 ,  0.01080236, 0.01068195,  0.00968061,  0.00951859,  0.01072359,  0.0102667 , 0.00956257,  0.00996936,  0.00963703,  0.00993394,  0.01009738, 0.00942758,  0.01007759,  0.01049392,  0.01014864,  0.00966363, 0.00983669,  0.0096251 ,  0.00903581,  0.00968845,  0.00988438, 0.00921231,  0.00982553,  0.00927551,  0.00982878,  0.00946823, 0.00995999,  0.00996873,  0.00939231,  0.00958738,  0.00992554, 0.00905414,  0.01032169,  0.0094531 ,  0.00904441,  0.00882512, 0.00911592,  0.00915665,  0.00938218,  0.00864436,  0.00909361, 0.00952012,  0.00927215,  0.00868863,  0.00921946,  0.00976264, 0.00948499,  0.00954731,  0.00876794,  0.00903813,  0.00922558, 0.00927597,  0.00928636,  0.00867572,  0.00923243,  0.00846059, 0.00820214,  0.00951224,  0.00835173,  0.00850419,  0.00891904, 0.00826819,  0.00845774,  0.00973348,  0.00878676,  0.00878545, 0.00854794,  0.0081923 ,  0.0082382 ,  0.0086202 ,  0.00871645, 0.00838147,  0.00866024,  0.00875515,  0.00876419,  0.0084661 , 0.00839194,  0.00765802,  0.00813951,  0.00813772,  0.00835001, 0.00843733,  0.00857433,  0.00824644,  0.00903745,  0.00802331, 0.00800912,  0.00753433,  0.00857311,  0.00894507,  0.0075698 , 0.00830863,  0.00770873,  0.00815065,  0.00823105,  0.00712311, 0.00746804,  0.00779225,  0.00859524,  0.00815094,  0.00814224, 0.00843004,  0.00842716,  0.00799333,  0.00768118,  0.00879745, 0.0073184 ,  0.00688598,  0.00785139,  0.00826017,  0.0088204 , 0.00726449,  0.00757954,  0.00773132,  0.00706447,  0.00760961, 0.00653646,  0.00804292,  0.00732314,  0.00737089,  0.00683164, 0.00815713,  0.00678828,  0.00751473,  0.00732897,  0.00701406, 0.00723904,  0.00703156,  0.00766463,  0.00831137,  0.00731366, 0.00704944,  0.0076263 ,  0.00705377,  0.00760795,  0.00719195, 0.00775809,  0.0074254 ,  0.00728454,  0.00772497,  0.00721468, 0.00644008,  0.00693488,  0.00731651,  0.00711951,  0.00676278, 0.00727995,  0.00726959,  0.00657437,  0.00695374,  0.00698619, 0.00690059,  0.00704713,  0.00704995,  0.00639138,  0.00654569, 0.00729811,  0.0067667 ,  0.0070561 ,  0.00699894,  0.00690868, 0.00653567,  0.00600622,  0.00661111,  0.00609861,  0.00640349, 0.00654165,  0.00625502,  0.00689919,  0.0060095 ,  0.00665601, 0.00712004,  0.00657849,  0.00707227,  0.00709255,  0.00624435, 0.00684536,  0.00708452,  0.00736538,  0.00648585,  0.00719255, 0.00691147,  0.00710146,  0.00667271,  0.00610051,  0.00660911, 0.00612828,  0.00583247,  0.0063546 ,  0.00689943,  0.00724132, 0.00599423,  0.00600421,  0.00660466,  0.0063068 ,  0.00660931, 0.00589716,  0.00603155,  0.00596684,  0.00634058,  0.00636252, 0.00614662,  0.00606683,  0.00627273,  0.00618774,  0.00658488])

explore_exploit_switch_probs_nans = np.array([ 0.15384925,  0.11666717,  0.1226977 ,  0.14066161,  0.0960978 , 0.093401,  0.08928684,  0.08655736,  0.08147729,  0.07986088, 0.07733403,  0.07539231,  0.07259575,  0.07123114,  0.06938085, 0.06791977,  0.06623672,  0.06523063,  0.0641024 ,  0.06366056, 0.06251274,  0.06202301,  0.06115419,  0.06055704,  0.05996946, 0.05952788,  0.05918521,  0.05920832,  0.05875492,  0.05835104, 0.05833563,  0.05820719,  0.05751882,  0.05748209,  0.0571787 , 0.05782686,  0.05776161,  0.05787137,  0.05736191,  0.05801851, 0.05774788,  0.05805045,  0.05823009,  0.05792065,  0.0579416 , 0.05829171,  0.05818347,  0.0591329 ,  0.05913613,  0.05941023, 0.0584089 ,  0.05863017,  0.05914267,  0.05974651,  0.05893367, 0.05960063,  0.05928795,  0.06042561,  0.05991822,  0.06084153, 0.06164633,  0.06083917,  0.06210883,  0.06193399,  0.06147105, 0.06261631,  0.06345779,  0.06349385,  0.06350095,  0.0632228 , 0.06400779,  0.06486709,  0.06363941,  0.06509027,  0.06438526, 0.06575075,  0.06450666,  0.06739756,  0.06506937,  0.06542218, 0.06683464,  0.06585127,  0.06583405,  0.0679442 ,  0.06671408, 0.06833946,  0.0691618 ,  0.06952462,  0.07075556,  0.07031666, 0.07048768,  0.07084951,  0.07158246,  0.07171959,  0.07202034, 0.07130925,  0.07345523,  0.07254593,  0.07267051,  0.07273074, 0.07575135,  0.07446736,  0.0731808 ,  0.07609998,  0.07445308, 0.07631654,  0.07729762,  0.07610919,  0.07715355,  0.07798547, 0.07887914,  0.08017043,  0.07758107,  0.0793136 ,  0.0798964 , 0.08093057,  0.07927939,  0.08076022,  0.0816591 ,  0.08117994, 0.08246096,  0.08249523,  0.08242465,  0.08315086,  0.08471684, 0.08514574,  0.08498249,  0.08313678,  0.08606118,  0.08361775, 0.08536153,  0.08754414,  0.08583425,  0.0868972 ,  0.08568161, 0.08564941,  0.08610549,  0.09058546,  0.09093438,  0.09048688, 0.09012821,  0.09059702,  0.09241668,  0.09327262,  0.09191925, 0.09054884,  0.09237858,  0.0949652 ,  0.09272001,  0.09256966, 0.09370768,  0.09262858,  0.09470659,  0.09376323,  0.0976155 , 0.0965947 ,  0.09936459,  0.09522329,  0.09641964,  0.09663026, 0.09889137,  0.09607635,  0.09822094,  0.10003211,  0.09940705, 0.09914068,  0.1006565 ,  0.10351023,  0.10210775,  0.1014211 , 0.09818124,  0.10045858,  0.10269884,  0.10195549,  0.1021488 , 0.10502316,  0.10539954,  0.10473492,  0.10496806,  0.10729662, 0.10715867,  0.10677967,  0.10373083,  0.10419848,  0.10274631, 0.10692982,  0.11298565,  0.10967781,  0.1090697 ,  0.11173419, 0.11142749,  0.11022093,  0.11375979,  0.11183984,  0.11038467, 0.11611333,  0.11421247,  0.11511033,  0.11440788,  0.11344729, 0.12201904,  0.11467288,  0.11571351,  0.1152985 ,  0.11757076, 0.11815835,  0.10873807,  0.11619237,  0.11899126,  0.11727218, 0.12020119,  0.11586451,  0.11653312,  0.11674918,  0.12013514, 0.12098104,  0.11546174,  0.11481068,  0.11692592,  0.11614058, 0.12317339,  0.12293292,  0.1253114 ,  0.12210019,  0.12318775, 0.12168882,  0.12316366,  0.12683957,  0.1218754 ,  0.12606999, 0.1275519 ,  0.12865085,  0.12527846,  0.1227828 ,  0.13198004, 0.12878272,  0.12587284,  0.13195737,  0.12515059,  0.12740138, 0.1343861 ,  0.13151575,  0.12263058,  0.12376807,  0.12997541, 0.12894668,  0.12972376,  0.13288691,  0.12981659,  0.1299816 , 0.13845203,  0.13792624,  0.14329838,  0.13318679,  0.12892471, 0.13599117,  0.13698594,  0.13807098,  0.13842139,  0.13983831, 0.13425846,  0.13574654,  0.14161072,  0.13787782,  0.13983689, 0.14330793,  0.13876809,  0.14526175,  0.13833745,  0.13976963, 0.13996199,  0.14017538,  0.1418137 ,  0.14993778,  0.14489947, 0.13636122,  0.13846337,  0.14796555,  0.13941724,  0.15144073, 0.14975532,  0.14591652,  0.14971802,  0.14734031,  0.14915806, 0.14326189,  0.15058052,  0.13947244,  0.14784264,  0.1440916 , 0.15204358,  0.14846468,  0.14755295,  0.14338627,  0.15104243, 0.1460621 ,  0.15295714,  0.15125937,  0.15934389,  0.15212763, 0.14975192,  0.15357582,  0.15047376,  0.16124402,  0.15729421, 0.16307455,  0.15547616,  0.15260343,  0.16371534,  0.15158724, 0.15939874,  0.1588    ,  0.15219372,  0.16279538,  0.15405514, 0.15823579,  0.1561151 ,  0.15681817,  0.15772339,  0.1608796 , 0.16347763,  0.16333136,  0.16073009,  0.16992857,  0.16937672, 0.16303016,  0.16699013,  0.15980441,  0.16543147,  0.16568355, 0.16158066,  0.1639793 ,  0.16441452,  0.16565501,  0.17608132, 0.16406738,  0.1625896 ,  0.162355  ,  0.15573261,  0.16594033, 0.16536795,  0.17105028,  0.16845935,  0.17507436,  0.16909934, 0.17646106,  0.16667371,  0.17700448,  0.16378539,  0.16867382, 0.1737935 ,  0.15633942,  0.17095678,  0.17173498,  0.18402474, 0.17801368,  0.17843423,  0.17508246,  0.16585844,  0.17363239, 0.17533934,  0.17972983,  0.17699429,  0.17306892,  0.1691851 , 0.16985827,  0.18544708,  0.17609532,  0.17230262,  0.17893337, 0.17199849,  0.18402058,  0.18924278,  0.1852602 ,  0.17675455, 0.18072309,  0.19514656,  0.18188556,  0.18019307,  0.18896959, 0.17869489,  0.18154089,  0.17598433,  0.16378757,  0.18818957, 0.18754232,  0.18302254,  0.20259533,  0.19213701,  0.18749818, 0.17452378,  0.17437418,  0.17035554,  0.19592252,  0.18965115, 0.17938078,  0.19116746,  0.19547662,  0.18894016,  0.20209214, 0.18453685,  0.1925986 ,  0.18897832,  0.19213801,  0.18548827, 0.19585756,  0.19907349,  0.17821381,  0.17490683,  0.18618349, 0.18034376,  0.17713926,  0.19802576,  0.19824861,  0.2095382 , 0.20536606,  0.19377851,  0.19458498,  0.20213367,  0.20090952, 0.19053294,  0.20453633,  0.18426417,  0.18819577,  0.19331252, 0.19182579,  0.19281166,  0.19806953,  0.19396077,  0.20166789, 0.18259667,  0.19804657,  0.19147019,  0.19109495,  0.201127  , 0.2026643 ,  0.20567792,  0.1954713 ,  0.19944655,  0.20149354, 0.20869831,  0.20125622,  0.20717964,  0.20422869,  0.2045025 , 0.19187313,  0.20854394,  0.20597691,  0.19780526,  0.20849817, 0.2058048 ,  0.18977506,  0.22228275,  0.1959364 ,  0.1913725 , 0.22811858,  0.20600418,  0.20260565,  0.19787263,  0.2022202 , 0.18673293,  0.20808928,  0.20155576,  0.18520117,  0.20990029, 0.20918134,  0.2211837 ,  0.21942729,  0.20590662,  0.21357321, 0.21745297,  0.21300149,  0.22274496,  0.21328461,  0.20776338, 0.19701301,  0.19879629,  0.20312896,  0.23192651,  0.21379511, 0.21116403,  0.2145371 ,  0.19728338,  0.19277571,  0.21244789, 0.20023672,  0.19763447,  0.23162288,  0.22775995,  0.20938281, 0.20248583,  0.22131215,  0.23493075,  0.22151954,  0.20698546, 0.22875431,  0.23892299,  0.23851302,  0.21220092,  0.22326912])

exploit_explore_switch_probs_nans = np.array([        np.nan,         np.nan,         np.nan,         np.nan,  0.14607468, 0.11903589,  0.09967423,  0.08739449,  0.07872719,  0.08409376, 0.08416979,  0.08158614,  0.07554546,  0.07031968,  0.06752486, 0.06582034,  0.06428269,  0.0637372 ,  0.06228856,  0.06291322, 0.06194241,  0.06240522,  0.06080322,  0.06080632,  0.06006818, 0.05920846,  0.05860114,  0.05820917,  0.05718514,  0.05754571, 0.05643588,  0.05665061,  0.05676489,  0.05638136,  0.05620816, 0.05590166,  0.05565336,  0.05536188,  0.05496505,  0.05530475, 0.05493458,  0.05463855,  0.05490738,  0.05463147,  0.05460337, 0.05432524,  0.05419244,  0.05503666,  0.0554054 ,  0.0554756 , 0.05457445,  0.05511033,  0.05450901,  0.05494831,  0.05545673, 0.05520954,  0.05509054,  0.05533582,  0.05593818,  0.05606471, 0.05621214,  0.05573173,  0.05636584,  0.05647076,  0.05656287, 0.05652944,  0.05677653,  0.05754338,  0.05709093,  0.05771892, 0.05770972,  0.05803934,  0.05831516,  0.0590125 ,  0.05914673, 0.0581906 ,  0.05961481,  0.05988036,  0.05988842,  0.06088206, 0.06065736,  0.06085188,  0.06028342,  0.06178111,  0.06280559, 0.06220658,  0.06231795,  0.06271803,  0.06321128,  0.06439915, 0.06397377,  0.06535205,  0.06455827,  0.06445702,  0.06609452, 0.06616628,  0.06590918,  0.06620457,  0.06713627,  0.06640404, 0.06673007,  0.06911839,  0.06780947,  0.06816126,  0.06817959, 0.06954726,  0.06879452,  0.06902687,  0.07253958,  0.07277552, 0.07141516,  0.07372607,  0.07304783,  0.07338714,  0.07383216, 0.07552059,  0.07495261,  0.07434445,  0.07504415,  0.07568421, 0.07529577,  0.07761126,  0.07738745,  0.07919865,  0.07748537, 0.07860418,  0.07704426,  0.07847498,  0.08104396,  0.07977953, 0.07986203,  0.08126035,  0.08211343,  0.08185842,  0.08002334, 0.08166998,  0.08365838,  0.08297031,  0.08406796,  0.08301625, 0.08430234,  0.08724823,  0.08710347,  0.08589181,  0.08607461, 0.08623713,  0.08607842,  0.08800281,  0.08828943,  0.0907934 , 0.09093333,  0.09015707,  0.09045515,  0.08968689,  0.09385664, 0.08977859,  0.09679855,  0.0931745 ,  0.09563773,  0.09581315, 0.09419281,  0.09428709,  0.0946068 ,  0.09748407,  0.0969939 , 0.09733209,  0.09665404,  0.09699444,  0.09983803,  0.09850189, 0.09961167,  0.09929149,  0.09857559,  0.09877236,  0.10358955, 0.10494925,  0.10139589,  0.10358332,  0.10591152,  0.10505179, 0.10818847,  0.10348876,  0.10550975,  0.1072796 ,  0.10706045, 0.10462523,  0.10713867,  0.1087925 ,  0.1070524 ,  0.11013279, 0.10637671,  0.11179703,  0.1128229 ,  0.10949537,  0.11040342, 0.11198231,  0.1140736 ,  0.1137872 ,  0.11344452,  0.11407322, 0.11297263,  0.11308182,  0.11633201,  0.11635994,  0.11047282, 0.11285774,  0.11790713,  0.12250951,  0.1197257 ,  0.11724174, 0.11742894,  0.11763564,  0.11897885,  0.11779226,  0.11364261, 0.12095191,  0.1237236 ,  0.12397105,  0.12263431,  0.12275695, 0.12397367,  0.12097184,  0.12992336,  0.12635119,  0.12643553, 0.12957541,  0.12414406,  0.128231  ,  0.12404476,  0.13355696, 0.12867842,  0.12270478,  0.13154175,  0.13068685,  0.12796259, 0.12994513,  0.12613595,  0.13534541,  0.13585812,  0.13483391, 0.13212849,  0.1333808 ,  0.13435626,  0.13488879,  0.13989683, 0.13748417,  0.13876935,  0.13978722,  0.14194828,  0.14009924, 0.14196359,  0.13620411,  0.1372731 ,  0.13622076,  0.14767379, 0.14514564,  0.14295596,  0.13745041,  0.139873  ,  0.14171762, 0.14164053,  0.14016479,  0.13956424,  0.14669977,  0.14087833, 0.14688721,  0.14433404,  0.15020524,  0.14578541,  0.14425201, 0.15592533,  0.14678431,  0.14436901,  0.15845113,  0.14795694, 0.16327764,  0.14416955,  0.15319216,  0.14334427,  0.15279113, 0.15297748,  0.15412345,  0.15095561,  0.15371363,  0.15341699, 0.16167038,  0.14572284,  0.1574447 ,  0.15610853,  0.15998134, 0.15784902,  0.15497461,  0.15553164,  0.15628786,  0.16030459, 0.16092699,  0.15037455,  0.15033261,  0.16083931,  0.15921773, 0.14788226,  0.15802937,  0.15710853,  0.16078453,  0.16615107, 0.15145613,  0.16156041,  0.17025343,  0.16598474,  0.16355208, 0.15803024,  0.16032765,  0.15354581,  0.16037394,  0.16566973, 0.15937907,  0.16763377,  0.1687992 ,  0.16928368,  0.16444882, 0.17396445,  0.16942425,  0.16834156,  0.17608021,  0.17438216, 0.16857832,  0.18434287,  0.16850741,  0.16519284,  0.16500811, 0.17001538,  0.1701897 ,  0.17452971,  0.16426521,  0.1764629 , 0.1814218 ,  0.17555633,  0.16330129,  0.17339058,  0.18522034, 0.17556402,  0.17841372,  0.16944816,  0.17625594,  0.17701739, 0.18945255,  0.17969391,  0.17687988,  0.18358998,  0.17156738, 0.16878286,  0.1888586 ,  0.17961116,  0.18158369,  0.18109358, 0.17416839,  0.18115543,  0.20239525,  0.18430352,  0.18790939, 0.18407247,  0.17949865,  0.17982361,  0.17973863,  0.18897777, 0.17912845,  0.19326738,  0.18923992,  0.18998057,  0.18568319, 0.18143812,  0.1720458 ,  0.18222319,  0.18760588,  0.19344819, 0.19133604,  0.19571638,  0.18408823,  0.20414294,  0.1950012 , 0.18745524,  0.18244478,  0.20288878,  0.21195886,  0.18779482, 0.19697834,  0.19231141,  0.19493903,  0.19335433,  0.17959837, 0.19038783,  0.19619281,  0.20013801,  0.19768705,  0.20059897, 0.20852342,  0.20453914,  0.20089292,  0.19449941,  0.21290195, 0.19331939,  0.18577851,  0.19819671,  0.20744087,  0.21862323, 0.18773778,  0.20448766,  0.19995957,  0.18785732,  0.20159711, 0.17929939,  0.22252409,  0.19336162,  0.20209867,  0.19432114, 0.21993812,  0.19221684,  0.20516586,  0.20790091,  0.19558008, 0.19661292,  0.20081046,  0.20879202,  0.21937796,  0.21006027, 0.20538956,  0.21004341,  0.20704509,  0.20845794,  0.20177947, 0.21152665,  0.20988072,  0.21547212,  0.21635035,  0.20878046, 0.19349682,  0.19875249,  0.21262592,  0.22641332,  0.20440701, 0.20941209,  0.22394874,  0.20832675,  0.21539823,  0.22454512, 0.21368778,  0.20753854,  0.22248456,  0.2150843 ,  0.21437136, 0.21911771,  0.21432171,  0.2190788 ,  0.2328811 ,  0.2076158 , 0.22165321,  0.20881137,  0.22074395,  0.19571369,  0.20875793, 0.22458887,  0.20758775,  0.22914737,  0.19793547,  0.21795607, 0.23608875,  0.21263812,  0.24308542,  0.22936599,  0.21516983, 0.23314764,  0.22939787,  0.23254621,  0.2264262 ,  0.23758257, 0.25097784,  0.22271998,  0.22280831,  0.21674417,  0.21708743, 0.21489917,  0.21340315,  0.22786851,  0.23778919,  0.23792912, 0.21974793,  0.21563835,  0.24088283,  0.21785132,  0.21960337, 0.21538488,  0.20908601,  0.21953783,  0.21822664,  0.23390526, 0.22674327,  0.221824  ,  0.23112886,  0.23320044,  0.22775322])



def sim_bout(probs):
    i=0
    switched = False
    while not switched:
        p = np.random.random()
        #print p,i,probs[i]
        if (p<probs[i]) or (i==499):
            switched = True
        i+=1
    return i

def run_sim(idx):

    explore_bouts = []
    exploit_bouts = []

    prob_type = 'zeros'
    new_explore_probs = np.repeat(.5,500)

    if prob_type =='zeros':
        exploit_switch_probs = exploit_explore_switch_probs_zeros
        #explore_switch_probs = explore_exploit_switch_probs_zeros
        explore_switch_probs = new_explore_probs
    elif prob_type == 'nans':
        exploit_switch_probs = exploit_explore_switch_probs_nans
        explore_switch_probs = explore_exploit_switch_probs_nans

    total = 0
    last = 'exploit'
    while total < 20000:
        if last == 'explore':
            n = sim_bout(exploit_switch_probs)
            exploit_bouts.append(n)
            last = 'exploit'
        else:
            n = sim_bout(explore_switch_probs)
            explore_bouts.append(n)
            last = 'explore'
        total += n

    # prob exploit given explore time
    result_explore = pd.Series(explore_bouts).value_counts()
    arr = result_explore.reindex(xrange(1,max(result_explore.index)+1),fill_value=0.).values.astype(float)
    final_result_explore = arr/np.cumsum(arr[::-1])[::-1]
    if len(final_result_explore)<500:
        final_result_explore = np.pad(final_result_explore,(0,500-len(arr)),mode='constant',constant_values=np.nan)

    # prob explore given exploit time
    result_exploit = pd.Series(exploit_bouts).value_counts()
    arr = result_exploit.reindex(xrange(1,max(result_exploit.index)+1),fill_value=0.).values.astype(float)
    final_result_exploit = arr/np.cumsum(arr[::-1])[::-1]
    if len(final_result_exploit)<500:
        final_result_exploit = np.pad(final_result_exploit,(0,500-len(arr)),mode='constant',constant_values=np.nan)

    return (final_result_explore,final_result_exploit)

pool = Pool(cpu_count())
indices = range(2000)
result = pool.map(run_sim,indices)
explore,exploit = zip(*result)
